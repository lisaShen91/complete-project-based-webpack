'use strict';

var _objectWithoutProperties2 = require('babel-runtime/helpers/objectWithoutProperties');

var _objectWithoutProperties3 = _interopRequireDefault(_objectWithoutProperties2);

var _select = require('../select');

var _select2 = _interopRequireDefault(_select);

var _input = require('../input');

var _input2 = _interopRequireDefault(_input);

var _button = require('../button');

var _utils = require('../utils');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

module.exports = function (obj, _Vdt, blocks, $callee) {
    var _classNameObj;

    _Vdt || (_Vdt = Vdt);
    obj || (obj = {});
    blocks || (blocks = {});
    var h = _Vdt.miss.h,
        hc = _Vdt.miss.hc,
        hu = _Vdt.miss.hu,
        widgets = this && this.widgets || {},
        _blocks = {},
        __blocks = {},
        __u = _Vdt.utils,
        extend = __u.extend,
        _e = __u.error,
        _className = __u.className,
        __o = __u.Options,
        _getModel = __o.getModel,
        _setModel = __o.setModel,
        _setCheckboxModel = __u.setCheckboxModel,
        _detectCheckboxChecked = __u.detectCheckboxChecked,
        _setSelectModel = __u.setSelectModel,
        self = this.data,
        $this = this,
        scope = obj,
        Animate = self && self.Animate,
        parent = ($callee || {})._super;

    var _self$get = self.get(),
        total = _self$get.total,
        current = _self$get.current,
        limit = _self$get.limit,
        limits = _self$get.limits,
        className = _self$get.className,
        showTotal = _self$get.showTotal,
        showGoto = _self$get.showGoto,
        counts = _self$get.counts,
        size = _self$get.size,
        noBorder = _self$get.noBorder,
        rest = (0, _objectWithoutProperties3.default)(_self$get, ['total', 'current', 'limit', 'limits', 'className', 'showTotal', 'showGoto', 'counts', 'size', 'noBorder']);

    if (!total) return hc(' pagination ');

    var classNameObj = (_classNameObj = {
        'k-pagination': true
    }, _classNameObj[className] = className, _classNameObj['k-' + size] = size !== 'default', _classNameObj['k-no-border'] = noBorder, _classNameObj);

    var type = 'default';
    if (noBorder) {
        type = 'none';
    }

    var totalPages = Math.ceil(total / limit) || 0;

    var paginationButton = function paginationButton(page) {
        return h(_button.Button, { 'type': function () {
                try {
                    return [type][0];
                } catch (e) {
                    _e(e);
                }
            }.call(this), 'size': function () {
                try {
                    return [size][0];
                } catch (e) {
                    _e(e);
                }
            }.call(this), 'icon': function () {
                try {
                    return [true][0];
                } catch (e) {
                    _e(e);
                }
            }.call(this), 'value': function () {
                try {
                    return [page][0];
                } catch (e) {
                    _e(e);
                }
            }.call(this), 'children': function () {
                try {
                    return [page][0];
                } catch (e) {
                    _e(e);
                }
            }.call(this), '_context': $this });
    };

    var paginationDot = function paginationDot(callback) {
        return h(_button.Button, { 'type': function () {
                try {
                    return [type][0];
                } catch (e) {
                    _e(e);
                }
            }.call(this), 'size': function () {
                try {
                    return [size][0];
                } catch (e) {
                    _e(e);
                }
            }.call(this), 'icon': function () {
                try {
                    return [true][0];
                } catch (e) {
                    _e(e);
                }
            }.call(this), 'className': 'k-ellipsis', 'ev-click': function () {
                try {
                    return [callback][0];
                } catch (e) {
                    _e(e);
                }
            }.call(this), 'children': '...', '_context': $this });
    };

    return h('div', null, [h(_button.ButtonGroup, { 'checkType': 'radio', 'v-model': 'current', 'children': [h(_button.Button, { 'icon': function () {
                try {
                    return [true][0];
                } catch (e) {
                    _e(e);
                }
            }.call(this), 'size': function () {
                try {
                    return [size][0];
                } catch (e) {
                    _e(e);
                }
            }.call(this), 'disabled': function () {
                try {
                    return [current <= 1][0];
                } catch (e) {
                    _e(e);
                }
            }.call(this), 'ev-click': function () {
                try {
                    return [self.prev][0];
                } catch (e) {
                    _e(e);
                }
            }.call(this), 'type': function () {
                try {
                    return [type][0];
                } catch (e) {
                    _e(e);
                }
            }.call(this), 'children': h('i', null, null, 'k-icon ion-ios-arrow-left'), '_context': $this }), function () {
            try {
                return [function () {
                    var items = [];
                    var minCount = Math.ceil(counts / 2);
                    var maxCount = totalPages - minCount;
                    var prevPage = current - 1;
                    var nextPage = current + 1;

                    if (totalPages > counts) {
                        if (current <= minCount) {
                            var max = counts - 2;
                            for (var i = 1; i <= max; i++) {
                                items.push(paginationButton(i));
                            }
                            items.push(paginationDot(self.fastNext));
                            items.push(paginationButton(totalPages));
                        } else if (current > minCount && current <= maxCount) {
                            items.push(paginationButton(1));
                            items.push(paginationDot(self.fastPrev));

                            var midCount = counts - 4;
                            var mid = Math.floor(midCount / 2);
                            var min = current - mid;
                            var _max = midCount % 2 === 1 ? current + mid : current + mid - 1;
                            for (var _i = min; _i <= _max; _i++) {
                                items.push(paginationButton(_i));
                            }

                            items.push(paginationDot(self.fastNext));
                            items.push(paginationButton(totalPages));
                        } else {
                            items.push(paginationButton(1));
                            items.push(paginationDot(self.fastPrev));

                            var _min = totalPages - counts + 3;
                            for (var _i2 = _min; _i2 <= totalPages; _i2++) {
                                items.push(paginationButton(_i2));
                            }
                        }
                    } else {
                        for (var _i3 = 1; _i3 <= totalPages; _i3++) {
                            items.push(paginationButton(_i3));
                        }
                    }

                    return items;
                }()][0];
            } catch (e) {
                _e(e);
            }
        }.call(this), h(_button.Button, { 'icon': function () {
                try {
                    return [true][0];
                } catch (e) {
                    _e(e);
                }
            }.call(this), 'size': function () {
                try {
                    return [size][0];
                } catch (e) {
                    _e(e);
                }
            }.call(this), 'disabled': function () {
                try {
                    return [current >= totalPages][0];
                } catch (e) {
                    _e(e);
                }
            }.call(this), 'ev-click': function () {
                try {
                    return [self.next][0];
                } catch (e) {
                    _e(e);
                }
            }.call(this), 'type': function () {
                try {
                    return [type][0];
                } catch (e) {
                    _e(e);
                }
            }.call(this), 'children': h('i', null, null, 'k-icon ion-ios-arrow-right'), '_context': $this })], '_context': $this, value: _getModel(self, 'current'), 'ev-$change:value': function ev$changeValue(__c, __n) {
            _setModel(self, 'current', __n, $this);
        } }), h('div', null, h(_select2.default, { 'v-model': 'limit', 'allowUnmatch': function () {
            try {
                return [true][0];
            } catch (e) {
                _e(e);
            }
        }.call(this), 'data': function () {
            try {
                return [limits.map(function (item) {
                    return { 'value': item, 'label': (0, _utils._$)('{n} 条 / 页', { n: item }) };
                })][0];
            } catch (e) {
                _e(e);
            }
        }.call(this), 'size': function () {
            try {
                return [size][0];
            } catch (e) {
                _e(e);
            }
        }.call(this), 'children': null, '_context': $this, value: _getModel(self, 'limit'), 'ev-$change:value': function ev$changeValue(__c, __n) {
            _setModel(self, 'limit', __n, $this);
        } }), 'k-limits'), function () {
        try {
            return [showGoto][0];
        } catch (e) {
            _e(e);
        }
    }.call(this) ? h('div', null, ['\n        ', function () {
        try {
            return [(0, _utils._$)('跳至')][0];
        } catch (e) {
            _e(e);
        }
    }.call(this), h(_input2.default, { 'size': function () {
            try {
                return [size][0];
            } catch (e) {
                _e(e);
            }
        }.call(this), 'value': function () {
            try {
                return [current][0];
            } catch (e) {
                _e(e);
            }
        }.call(this), 'ev-change': function () {
            try {
                return [self._goto][0];
            } catch (e) {
                _e(e);
            }
        }.call(this), 'children': null, '_context': $this }), function () {
        try {
            return [(0, _utils._$)('页')][0];
        } catch (e) {
            _e(e);
        }
    }.call(this), '\n    '], 'k-goto') : undefined, function () {
        try {
            return [showTotal][0];
        } catch (e) {
            _e(e);
        }
    }.call(this) ? h('div', null, function () {
        try {
            return [(0, _utils._$)('共 {n} 条', { n: total })][0];
        } catch (e) {
            _e(e);
        }
    }.call(this), 'k-total') : undefined], _className(function () {
        try {
            return [classNameObj][0];
        } catch (e) {
            _e(e);
        }
    }.call(this)));
};